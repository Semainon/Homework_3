### Д3 3.6. Написать скрипт, который проверяет размер примонтированных разделов дисков,
Аргументы скрипта:
- вывод помощи
- процент свободного пространства

Если свободного места осталось менее процента из аргумента, отправить сообщение в телеграм

1. **Поместить вызов скрипта каждые 8 минут в крон**: Выводит информацию о всех интерфейсах с их IP-адресами в компактном формате.
2. **Поместить задание в крон не используя утилиту crontab с параметром -e**
3. **Заменить вызов cron на systemd-timers**

### Терминал
```bash

root@Zero scripts]# nano disk-check.sh
[root@Zero scripts]# chmod +x disk-check.sh
[root@Zero scripts]# ./disk-check.sh
Нужна справка? (y/n): y
Использование: ./disk-check.sh [процент]
Этот скрипт проверяет свободное место на примонтированных разделах дисков.
Если свободного места осталось менее указанного процента, отправляет сообщение в Telegram.
Аргументы:
  процент   Минимальный процент свободного пространства для отправки уведомления.
Введите минимальный процент свободного пространства (например, 10): 99   # сообщение не отправляется

[root@Zero scripts]# ./disk-check.sh
Нужна справка? (y/n): n
Введите минимальный процент свободного пространства (например, 10): 99
root@Zero scripts]# ./disk-check.sh
Нужна справка? (y/n): n
Введите минимальный процент свободного пространства (например, 10): 1
{"ok":true,"result":{"message_id":351,"from":{"id":**************,"is_bot":true,"first_name":"***********","username":"**********"},"chat":{"id":**********,"first_name":"**********","username":"**********","type":"private"},"date":1732916503,"text":"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435! \u041d\u0430 \u0440\u0430\u0437\u0434\u0435\u043b\u0435 /dev/vda2 \u043e\u0441\u0442\u0430\u043b\u043e\u0441\u044c \u043c\u0435\u043d\u0435\u0435 1% \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u043e\u0433\u043e \u043c\u0435\u0441\u0442\u0430."}}{"ok":true,"result":{"message_id":352,"from":{"id":**********,"is_bot":true,"first_name":"**********","username":"**********"},"chat":{"id":**********,"first_name":"**********","username":"**********","type":"private"},"date":1732916503,"text":"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435! \u041d\u0430 \u0440\u0430\u0437\u0434\u0435\u043b\u0435 /dev/vda1 \u043e\u0441\u0442\u0430\u043b\u043e\u0441\u044c \u043c\u0435\u043d\u0435\u0435 1% \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u043e\u0433\u043e \u043c\u0435\u0441\u0442\u0430."}}
[root@Zero scripts]# 

```


### disk-check.sh v.2 | Скрипт проверяет размер примонтированных разделов дисков, отправляет уведомление в Telegram, если свободного места осталось менее указанного процента

```bash
#!/bin/bash

# Функция для вывода помощи
show_help() {
    cat << EOF
Использование: $0 [процент]

Этот скрипт проверяет свободное место на примонтированных разделах дисков.
Если свободного места осталось менее указанного процента, отправляет сообщение в Telegram.

Аргументы:
  процент   Минимальный процент свободного пространства для отправки уведомления.
EOF
}

# Запрос справки у пользователя
read -p "Нужна справка? (y/n): " need_help
if [[ "$need_help" == "y" ]]; then
    show_help
    exit 0
fi

# Запрос ввода процента
read -p "Введите минимальный процент свободного пространства (например, 10): " THRESHOLD

# Проверка, является ли аргумент числом
if ! [[ "$THRESHOLD" =~ ^[0-9]+$ ]]; then
    echo "Ошибка: аргумент должен быть целым числом."
    exit 1
fi

# Получение информации о свободном месте на дисках
df -h --output=source,pcent | grep -vE '^Filesystem|tmpfs|cdrom' | while read -r line; do
    PARTITION=$(echo $line | awk '{print $1}')
    USAGE=$(echo $line | awk '{print $2}' | sed 's/%//')

    # Проверка, если использование больше порога
    if [ "$USAGE" -ge "$THRESHOLD" ]; then
        MESSAGE="Внимание! На разделе $PARTITION осталось менее $THRESHOLD% свободного места."
        
        # Отправка сообщения в Telegram
        curl -s -X POST "https://api.telegram.org/bot<MY_BOT_TOKEN>/sendMessage" \
        -d "chat_id=<MY_CHAT_ID>" \
        -d "text=$MESSAGE"
    fi
done
```

