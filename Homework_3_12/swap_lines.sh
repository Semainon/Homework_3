#!/bin/bash

# Устанавливаем параметры для надежного выполнения скрипта
set -Eeuo pipefail

# Функция для вывода справки
usage() {
    cat << EOF
Использование: $0
Этот скрипт копирует содержимое входного файла в выходной файл, меняя местами четные и нечетные строки.
Если входной файл не существует или выходной файл уже существует, скрипт завершает работу.
EOF
}

# Функция для обработки завершения скрипта
cleanup() {
    echo "Завершение работы скрипта..."
    exit 0
}

# Обработка сигналов для корректного завершения
trap cleanup SIGINT SIGTERM ERR EXIT

# Вывод справки
usage

# Запрос входного файла
read -p "Введите путь к входному файлу: " INPUT_FILE

# Проверка существования входного файла
if [ ! -f "$INPUT_FILE" ]; then
    echo "Ошибка: Входной файл '$INPUT_FILE' не существует."
    exit 1
fi

# Запрос выходного файла
read -p "Введите путь к выходному файлу: " OUTPUT_FILE

# Проверка существования выходного файла
if [ -f "$OUTPUT_FILE" ]; then
    echo "Ошибка: Выходной файл '$OUTPUT_FILE' уже существует."
    exit 1
fi

# Чтение входного файла и обмен строками
{
    # Считываем строки в массив
    mapfile -t lines < "$INPUT_FILE"

    # Обмен местами четных и нечетных строк
    for ((i = 0; i < ${#lines[@]}; i+=2)); do
        if [ $((i + 1)) -lt ${#lines[@]} ]; then
            echo "${lines[i + 1]}" >> "$OUTPUT_FILE"
            echo "${lines[i]}" >> "$OUTPUT_FILE"
        else
            echo "${lines[i]}" >> "$OUTPUT_FILE"  # Если нечетная строка без пары
        fi
    done
}

echo "Содержимое входного файла успешно записано в выходной файл '$OUTPUT_FILE'."

